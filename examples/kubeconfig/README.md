# Kubeconfig Examples

This directory contains example kubeconfig files generated by HyperFleet Cloud Provider for different cloud platforms.

## Available Examples

- **`kubeconfig-gcp.yaml`** - Google Kubernetes Engine (GKE) configuration
- **`kubeconfig-aws.yaml`** - Amazon Elastic Kubernetes Service (EKS) configuration
- **`kubeconfig-azure.yaml`** - Azure Kubernetes Service (AKS) configuration

## Generating Kubeconfig

Instead of manually editing these examples, use the `generate-kubeconfig` command:

```bash
# GCP/GKE
hyperfleet-credential-provider generate-kubeconfig \
  --provider=gcp \
  --cluster-name=my-cluster \
  --project-id=my-project \
  --region=us-central1-a \
  --credentials-file=/path/to/gcp-sa.json \
  --output=kubeconfig.yaml

# AWS/EKS
hyperfleet-credential-provider generate-kubeconfig \
  --provider=aws \
  --cluster-name=my-cluster \
  --region=us-east-1 \
  --output=kubeconfig.yaml

# Azure/AKS
hyperfleet-credential-provider generate-kubeconfig \
  --provider=azure \
  --cluster-name=my-cluster \
  --subscription-id=xxx \
  --tenant-id=xxx \
  --resource-group=my-rg \
  --output=kubeconfig.yaml
```

## Usage

1. Copy the appropriate example for your cloud provider
2. Replace placeholder values with your actual cluster information:
   - Cluster endpoint URL
   - Certificate authority data
   - Project/account/subscription IDs
   - Credential paths or values

3. Save the kubeconfig to a file (e.g., `~/.kube/config`)

4. Use kubectl with the kubeconfig:
   ```bash
   export KUBECONFIG=/path/to/kubeconfig.yaml
   kubectl get pods
   ```

## Container Usage

When using HyperFleet Cloud Provider in a container, ensure credentials are mounted:

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: kubectl-pod
spec:
  containers:
  - name: kubectl
    image: bitnami/kubectl:latest
    volumeMounts:
    # Mount kubeconfig
    - name: kubeconfig
      mountPath: /root/.kube
      readOnly: true
    # Mount cloud credentials
    - name: cloud-creds
      mountPath: /vault/secrets
      readOnly: true
  volumes:
  - name: kubeconfig
    configMap:
      name: kubeconfig
  - name: cloud-creds
    secret:
      secretName: cloud-credentials
```

## Environment Variables

### Command-Line Flags as Environment Variables

All command-line flags can be set via environment variables using the `HFCP_` prefix:

```bash
# Instead of using flags
hyperfleet-credential-provider generate-kubeconfig \
  --provider=gcp \
  --cluster-name=my-cluster \
  --project-id=my-project \
  --region=us-central1-a

# You can use environment variables
export HFCP_PROVIDER=gcp
export HFCP_CLUSTER_NAME=my-cluster
export HFCP_PROJECT_ID=my-project
export HFCP_REGION=us-central1-a

hyperfleet-credential-provider generate-kubeconfig
```

### Common Environment Variables

| Environment Variable | Flag | Description |
|---------------------|------|-------------|
| `HFCP_PROVIDER` | `--provider` | Cloud provider (gcp, aws, azure) |
| `HFCP_CLUSTER_NAME` | `--cluster-name` | Cluster name |
| `HFCP_CREDENTIALS_FILE` | `--credentials-file` | Path to credentials file |
| `HFCP_REGION` | `--region` | Cloud region/location |
| `HFCP_PROJECT_ID` | `--project-id` | GCP project ID |
| `HFCP_SUBSCRIPTION_ID` | `--subscription-id` | Azure subscription ID |
| `HFCP_TENANT_ID` | `--tenant-id` | Azure tenant ID |
| `HFCP_LOG_LEVEL` | `--log-level` | Log level (debug, info, warn, error) |
| `HFCP_LOG_FORMAT` | `--log-format` | Log format (json, console) |

**Priority**: Flags > Environment Variables > Default Values

## Security Notes

- **Never commit credentials to version control**
- Use secret management systems (Vault, Kubernetes Secrets, etc.)
- Follow principle of least privilege for cloud IAM permissions
- Rotate credentials regularly

## References

- [Kubernetes Exec Plugin Documentation](https://kubernetes.io/docs/reference/access-authn-authz/authentication/#client-go-credential-plugins)
- [HyperFleet Cloud Provider Documentation](../README.md)
